\* HotStuff-2 TLA+ Configuration: Fault-Tolerance
\* Purpose: Verify safety and liveness under Byzantine faults (f=1 crash fault)
\* Verified: 26K states, 10K distinct, 13 seconds
\*
\* This config tests the critical BFT property:
\* - With n=4 replicas and f=1 faulty, the protocol must still make progress
\* - This REQUIRES the leader to count its own vote (2f+1 = 3 votes needed)
\* - Without leader's vote: only 2 honest non-leaders available = deadlock
\*
\* Leader rotation: Leader(v) = (v % 4) + 1
\* - View 0,4: replica 1 (honest)
\* - View 1:   replica 2 (honest)
\* - View 2:   replica 3 (honest)
\* - View 3:   replica 4 (FAULTY - honest replicas must timeout to view 4)
\*
\* MaxView >= 4: allows progress past faulty leader in view 3
\* MaxHeight >= 3: ensures enough blocks for views 0, 4, and 5 (two-chain commit)

CONSTANTS
    Replica = {1, 2, 3, 4}
    Faulty = {4}
    MaxView = 4
    MaxHeight = 3
    Genesis = 0
    Nil = -1

\* Use FairSpec for liveness verification under faults
SPECIFICATION FairSpec

CONSTRAINT StateConstraint

\* Safety invariants (12)
INVARIANTS
    TypeInvariant
    AgreementInvariant
    ValidityInvariant
    QCIntegrityInvariant
    ForkFreedomInvariant
    CommitChainInvariant
    NoDoubleVoteInvariant
    SingleProposalInvariant
    VotesSubsetReplicasInvariant
    UniqueQCPerViewInvariant
    HonestAgreementInvariant
    HonestValidityInvariant

\* Liveness properties (4)
PROPERTIES
    EventuallyCommit
    EventualProgress
    ViewEventuallyCompletes
    EventualViewSync
